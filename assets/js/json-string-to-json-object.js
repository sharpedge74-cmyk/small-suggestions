const editor=document.getElementById("json-editor"),viewer=$("#json-tree-viewer"),popup=document.getElementById("copied-popup");let previewData=null;function parseJsonString(){try{let e=editor.value.trim();if(!e)return null;let t=JSON.parse(e);return"string"==typeof t&&(t=JSON.parse(t)),t}catch{return null}}function updateViewer(){previewData=parseJsonString(),viewer.empty(),previewData?viewer.JSONView(previewData,{collapsed:!1}):viewer.text("Invalid JSON string")}function showCopiedPopup(e="Copied!"){popup.textContent=e,popup.style.opacity="1",setTimeout((()=>popup.style.opacity="0"),1500)}async function copyJson(){if(!previewData)return showCopiedPopup("Invalid JSON");const e=JSON.stringify(previewData,null,2);try{await navigator.clipboard.writeText(e),showCopiedPopup("Copied!")}catch{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),showCopiedPopup("Copied!")}}function downloadJson(){if(!previewData)return showCopiedPopup("Invalid JSON");const e=new Blob([JSON.stringify(previewData,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),o=document.createElement("a");o.href=t,o.download="converted.json",o.click(),URL.revokeObjectURL(t)}editor.addEventListener("input",updateViewer),updateViewer();